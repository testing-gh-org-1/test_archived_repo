package com.example.demo;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;
import java.io.File;
import java.io.FileWriter;

// CWE-285: Improper Authorization
// CWE-287: Improper Authentication
public class AuthenticationAuthorizationVulnerability {
    
    // CWE-287: No authentication check
    public void accessAdminPanel(HttpServletRequest request) {
        // Vulnerable: no authentication required
        String action = request.getParameter("action");
        // Execute admin action
    }
    
    // CWE-285: Missing authorization check
    public void deleteUser(HttpServletRequest request, String targetUserId) {
        HttpSession session = request.getSession();
        // Vulnerable: no check if current user can delete target user
        // Delete user logic
    }
    
    // CWE-285: Insecure Direct Object Reference
    public String viewUserProfile(String userId) {
        // Vulnerable: no ownership or permission check
        return "User profile data for: " + userId;
    }
    
    // CWE-287: Authentication bypass
    public boolean authenticate(String username, String password) {
        // Vulnerable: weak authentication logic
        if (username != null && !username.isEmpty()) {
            return true; // Anyone can authenticate
        }
        return false;
    }
    
    // CWE-285: Missing function level access control
    public void changeUserRole(String userId, String newRole) {
        // Vulnerable: no check if caller has permission
        // Change role logic
    }
    
    // CWE-285: Authorization bypass through parameter manipulation
    public void viewDocument(HttpServletRequest request) {
        String docId = request.getParameter("docId");
        String isAdmin = request.getParameter("isAdmin");
        
        // Vulnerable: trusting client-side parameter
        if ("true".equals(isAdmin)) {
            // Show document
        }
    }
    
    // CWE-287: Missing password verification
    public void changeEmail(HttpServletRequest request) {
        HttpSession session = request.getSession();
        String newEmail = request.getParameter("email");
        
        // Vulnerable: no password confirmation required
        session.setAttribute("email", newEmail);
    }
    
    // CWE-285: Privilege escalation
    public void grantPermissions(String userId, String permission) {
        // Vulnerable: no check if current user can grant permissions
        // Grant permission logic
    }
}
