package com.example.demo;

import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

// CWE-311: Missing Encryption of Sensitive Data
// CWE-319: Cleartext Transmission of Sensitive Information
public class InsecureDataTransmissionVulnerability {
    
    // CWE-311: Storing password in plain text
    public void storePassword(String username, String password) {
        // Vulnerable: storing password without encryption
        // Database logic with plain text password
    }
    
    // CWE-319: Sending credentials over HTTP
    public void sendCredentials(HttpServletResponse response, String username, String password) {
        try {
            // Vulnerable: transmitting credentials in cleartext
            response.getWriter().println("Username: " + username);
            response.getWriter().println("Password: " + password);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    // CWE-311: Cookie without secure flag
    public void createInsecureCookie(HttpServletResponse response, String sessionId) {
        // Vulnerable: cookie without Secure flag
        Cookie cookie = new Cookie("sessionId", sessionId);
        cookie.setMaxAge(3600);
        // Missing: cookie.setSecure(true);
        response.addCookie(cookie);
    }
    
    // CWE-311: Cookie without HttpOnly flag
    public void createCookieWithoutHttpOnly(HttpServletResponse response, String token) {
        // Vulnerable: cookie accessible via JavaScript
        Cookie cookie = new Cookie("authToken", token);
        cookie.setMaxAge(7200);
        // Missing: cookie.setHttpOnly(true);
        response.addCookie(cookie);
    }
    
    // CWE-319: Transmitting credit card in plain text
    public void processCreditCard(String cardNumber, String cvv, String expiryDate) {
        // Vulnerable: handling sensitive card data without encryption
        System.out.println("Processing card: " + cardNumber);
    }
    
    // CWE-311: Storing sensitive data in session without encryption
    public void storeSensitiveDataInSession(HttpServletRequest request, String ssn, String creditCard) {
        HttpSession session = request.getSession();
        // Vulnerable: storing PII without encryption
        session.setAttribute("ssn", ssn);
        session.setAttribute("creditCard", creditCard);
    }
    
    // CWE-319: Logging sensitive data
    public void logPaymentInfo(String cardNumber, String amount) {
        // Vulnerable: logging sensitive information
        System.out.println("Payment processed: Card=" + cardNumber + ", Amount=" + amount);
    }
}
