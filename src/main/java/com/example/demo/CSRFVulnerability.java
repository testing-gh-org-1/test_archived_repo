package com.example.demo;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

// CWE-352: Cross-Site Request Forgery (CSRF)
public class CSRFVulnerability {
    
    // CWE-352: Password change without CSRF protection
    public void changePassword(HttpServletRequest request, HttpServletResponse response) throws IOException {
        String newPassword = request.getParameter("newPassword");
        String userId = request.getParameter("userId");
        
        // Vulnerable: no CSRF token validation
        // Password change logic
        response.getWriter().println("Password changed for user: " + userId);
    }
    
    // CWE-352: Delete account without CSRF protection
    public void deleteAccount(HttpServletRequest request) {
        HttpSession session = request.getSession();
        String userId = (String) session.getAttribute("userId");
        
        // Vulnerable: no CSRF protection on dangerous action
        // Delete account logic
    }
    
    // CWE-352: Money transfer without CSRF protection
    public void transferMoney(HttpServletRequest request, HttpServletResponse response) throws IOException {
        String toAccount = request.getParameter("to");
        String amount = request.getParameter("amount");
        
        // Vulnerable: financial transaction without CSRF token
        response.getWriter().println("Transferred $" + amount + " to " + toAccount);
    }
    
    // CWE-352: Email change without verification
    public void changeEmail(HttpServletRequest request) {
        String newEmail = request.getParameter("email");
        HttpSession session = request.getSession();
        
        // Vulnerable: no CSRF protection
        session.setAttribute("email", newEmail);
    }
    
    // CWE-352: Admin action without CSRF protection
    public void grantAdminPrivileges(HttpServletRequest request) {
        String targetUserId = request.getParameter("userId");
        
        // Vulnerable: privileged action without CSRF protection
        // Grant admin logic
    }
}
