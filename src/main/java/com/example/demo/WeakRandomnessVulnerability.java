package com.example.demo;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;
import java.util.Random;

// CWE-330: Use of Insufficiently Random Values
// CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
public class WeakRandomnessVulnerability {
    
    // CWE-330: Weak random for session ID
    public String generateSessionId() {
        // Vulnerable: using Math.random() for security-sensitive value
        return String.valueOf(Math.random() * 1000000);
    }
    
    // CWE-338: Weak PRNG for token generation
    public String generateAuthToken() {
        // Vulnerable: using java.util.Random for security token
        Random random = new Random();
        return String.valueOf(random.nextLong());
    }
    
    // CWE-330: Predictable password reset token
    public String generatePasswordResetToken(String email) {
        // Vulnerable: using current time as seed
        Random random = new Random(System.currentTimeMillis());
        StringBuilder token = new StringBuilder();
        for (int i = 0; i < 16; i++) {
            token.append(random.nextInt(10));
        }
        return token.toString();
    }
    
    // CWE-338: Weak random for encryption key
    public byte[] generateEncryptionKey() {
        // Vulnerable: predictable random for cryptographic key
        Random random = new Random();
        byte[] key = new byte[16];
        random.nextBytes(key);
        return key;
    }
    
    // CWE-330: Predictable CAPTCHA
    public String generateCaptcha() {
        // Vulnerable: weak random for CAPTCHA
        Random random = new Random();
        return String.format("%04d", random.nextInt(10000));
    }
    
    // CWE-338: Weak random for OTP
    public String generateOTP() {
        // Vulnerable: Math.random() for one-time password
        int otp = (int) (Math.random() * 900000) + 100000;
        return String.valueOf(otp);
    }
    
    // CWE-330: Predictable transaction ID
    public String generateTransactionId() {
        // Vulnerable: sequential or predictable ID
        Random random = new Random(12345);
        return "TXN" + random.nextInt(999999);
    }
}
