package com.example.demo;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.Cookie;
import java.io.IOException;

// CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')
public class XSSVulnerability {
    
    // CWE-79: Reflected XSS in response
    public void reflectedXSS(HttpServletRequest request, HttpServletResponse response) throws IOException {
        String username = request.getParameter("username");
        // Vulnerable: directly outputting user input without encoding
        response.getWriter().println("<html><body>");
        response.getWriter().println("<h1>Welcome " + username + "</h1>");
        response.getWriter().println("</body></html>");
    }
    
    // CWE-79: XSS in search results
    public void searchResults(HttpServletRequest request, HttpServletResponse response) throws IOException {
        String searchQuery = request.getParameter("q");
        // Vulnerable: unescaped search term in HTML
        response.setContentType("text/html");
        response.getWriter().println("<html><body>");
        response.getWriter().println("<p>Search results for: " + searchQuery + "</p>");
        response.getWriter().println("</body></html>");
    }
    
    // CWE-79: XSS in error messages
    public String displayError(String errorMessage) {
        // Vulnerable: user-controlled error message in HTML
        return "<div class='error'>Error: " + errorMessage + "</div>";
    }
    
    // CWE-79: DOM-based XSS
    public void domBasedXSS(HttpServletResponse response, String userInput) throws IOException {
        // Vulnerable: JavaScript with user input
        response.getWriter().println("<script>");
        response.getWriter().println("var data = '" + userInput + "';");
        response.getWriter().println("document.getElementById('output').innerHTML = data;");
        response.getWriter().println("</script>");
    }
    
    // CWE-79: XSS in attributes
    public String createLink(String url, String text) {
        // Vulnerable: unescaped attribute values
        return "<a href='" + url + "'>" + text + "</a>";
    }
    
    // CWE-79: XSS in JavaScript context
    public void jsContextXSS(HttpServletResponse response, String callback) throws IOException {
        // Vulnerable: user input in JavaScript callback
        response.setContentType("application/javascript");
        response.getWriter().println(callback + "({'status': 'success'});");
    }
    
    // CWE-79: Stored XSS
    public String displayComment(String comment, String author) {
        // Vulnerable: displaying stored user content without escaping
        return "<div class='comment'>" +
               "<p>" + comment + "</p>" +
               "<span class='author'>By: " + author + "</span>" +
               "</div>";
    }
    
    // CWE-79: XSS in JSON response
    public void jsonResponse(HttpServletResponse response, String message) throws IOException {
        // Vulnerable: unescaped JSON
        response.setContentType("application/json");
        response.getWriter().println("{\"message\": \"" + message + "\"}");
    }
}
